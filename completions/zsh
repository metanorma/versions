# Mnenv Zsh completion

#compdef mnenv

_mnenv() {
    local -a commands
    commands=(
        'install:Install a Metanorma version'
        'use:Set Metanorma version for current shell session'
        'global:Set default Metanorma version globally'
        'local:Set Metanorma version for current directory'
        'versions:List all installed Metanorma versions'
        'uninstall:Uninstall a Metanorma version'
        'help:Show help'
        'gemfile:Gemfile-related commands'
        'snap:Snap-related commands'
        'homebrew:Homebrew-related commands'
        'chocolatey:Chocolatey-related commands'
        'info:Show information about a version'
        'list:List available versions'
        'list-all:List all available versions across sources'
        'version:Show mnenv version'
    )

    if (( CURRENT == 2 )); then
        _describe 'command' commands
    else
        case "${words[2]}" in
            install|use|global|local|uninstall)
                local -a versions
                versions=($(ls -1 ~/.mnenv/versions/ 2>/dev/null))
                _describe 'version' versions
                ;;
        esac
    fi
}

_mnenv "$@"

# Add ~/.mnenv/shims to PATH if not already present
if [[ ":$PATH:" != *":$HOME/.mnenv/shims:"* ]]; then
    export PATH="$HOME/.mnenv/shims:$PATH"
fi
